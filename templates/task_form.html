{% extends "base.html" %}

{% block title %}{{ action }} Task - HighCommand{% endblock %}

{% block content %}
<h1>{{ action }} TASK</h1>
<h3>PROJECT: {{ project.name }}</h3>

<div class="card mt-3">
    <form method="POST">
        <div class="form-group">
            <label for="title">TITLE *</label>
            <input type="text" id="title" name="title" required value="{{ task.title if task else '' }}"
                placeholder="At least 3 characters">
        </div>

        <div class="form-group">
            <label for="description">DESCRIPTION</label>
            <textarea id="description" name="description"
                placeholder="Optional task description">{{ task.description if task else '' }}</textarea>
        </div>

        <div class="grid grid-2">
            <div class="form-group">
                <label for="status">STATUS *</label>
                <select id="status" name="status" required>
                    {% for s in statuses %}
                    <option value="{{ s }}" {% if task and task.status==s %}selected{% endif %}>
                        {{ s|upper }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="priority">PRIORITY *</label>
                <select id="priority" name="priority" required>
                    {% for p in priorities %}
                    <option value="{{ p }}" {% if task and task.priority==p %}selected{% elif not task and p=='medium'
                        %}selected{% endif %}>
                        {{ p|upper }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="form-group">
                <label for="due_date">DUE DATE</label>
                <input type="date" id="due_date" name="due_date" value="{{ task.due_date if task else '' }}">
            </div>
        </div>

        <div class="form-group">
            <label>ASSIGNEES</label>
            <div class="checkbox-grid">
                {% for member in members %}
                <label class="checkbox-item">
                    <input type="checkbox" name="assignee_ids" value="{{ member.id }}" {% if task and member.id in
                        task.assignees|map(attribute='id' )|list %}checked{% endif %}>
                    <span class="checkbox-label">{{ member.username }}</span>
                    <span class="badge">{{ member.role|upper }}</span>
                </label>
                {% endfor %}
            </div>
            <small>Select one or more team members to assign this task</small>
        </div>

        <div class="btn-group">
            <button type="submit" class="btn btn-primary">{{ action|upper }}</button>
            <a href="{% if task %}{{ url_for('task_detail', task_id=task.id) }}{% else %}{{ url_for('project_detail', project_id=project.id) }}{% endif %}"
                class="btn">CANCEL</a>
        </div>
    </form>
</div>
{% endblock %}